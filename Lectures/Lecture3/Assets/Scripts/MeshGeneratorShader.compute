#pragma kernel Generate

struct Output
{
     float3 vertex[3];
     float3 normal[3];
     int hasValue;
};

AppendStructuredBuffer<Output> outputBuffer;
int ballsCount;
RWStructuredBuffer<float3> ballsPositions;
float ballRadius;
float minBound;
float size;

static int cubeEdges[12][2] =
{
        {0, 1}, // 0
        {1, 2}, // 1
        {2, 3}, // 2
        {3, 0}, // 3
        {4, 5}, // 4
        {5, 6}, // 5
        {6, 7}, // 6
        {7, 4}, // 7
        {0, 4}, // 8
        {1, 5}, // 9
        {2, 6}, // 10
        {3, 7}, // 11
};

static int caseToTrianglesCount[256] =
{
    0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 2, 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 3,
    1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 3, 2, 3, 3, 2, 3, 4, 4, 3, 3, 4, 4, 3, 4, 5, 5, 2,
    1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 3, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 4,
    2, 3, 3, 4, 3, 4, 2, 3, 3, 4, 4, 5, 4, 5, 3, 2, 3, 4, 4, 3, 4, 5, 3, 2, 4, 5, 5, 4, 5, 2, 4, 1,
    1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 3, 2, 3, 3, 4, 3, 4, 4, 5, 3, 2, 4, 3, 4, 3, 5, 2,
    2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 4, 3, 4, 4, 3, 4, 5, 5, 4, 4, 3, 5, 2, 5, 4, 2, 1,
    2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 2, 3, 3, 2, 3, 4, 4, 5, 4, 5, 5, 2, 4, 3, 5, 4, 3, 2, 4, 1,
    3, 4, 4, 5, 4, 5, 3, 4, 4, 5, 5, 2, 3, 4, 2, 1, 2, 3, 3, 2, 3, 4, 2, 1, 3, 2, 4, 1, 2, 1, 1, 0
};

static int3 caseToVertices[256][5] = 
        {
            {
                int3(-1, -1, -1), int3(-1, -1, -1), int3(-1, -1, -1), int3(-1, -1, -1),
                int3(-1, -1, -1)
            },
            
            {
                 int3(0, 8, 3),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 9),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(1, 8, 3),  int3(9, 8, 1),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 2, 10),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 8, 3),  int3(1, 2, 10),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 2, 10),  int3(0, 2, 9),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(2, 8, 3),  int3(2, 10, 8),  int3(10, 9, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 11, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 11, 2),  int3(8, 11, 0),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 9, 0),  int3(2, 3, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 11, 2),  int3(1, 9, 11),  int3(9, 8, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 10, 1),  int3(11, 10, 3),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 10, 1),  int3(0, 8, 10),  int3(8, 11, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 9, 0),  int3(3, 11, 9),  int3(11, 10, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 8, 10),  int3(10, 8, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(4, 7, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(4, 3, 0),  int3(7, 3, 4),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 9),  int3(8, 4, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(4, 1, 9),  int3(4, 7, 1),  int3(7, 3, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(1, 2, 10),  int3(8, 4, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 4, 7),  int3(3, 0, 4),  int3(1, 2, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 2, 10),  int3(9, 0, 2),  int3(8, 4, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 10, 9),  int3(2, 9, 7),  int3(2, 7, 3),  int3(7, 9, 4),  int3(-1, -1, -1)},
            
            {
                 int3(8, 4, 7),  int3(3, 11, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(11, 4, 7),  int3(11, 2, 4),  int3(2, 0, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 0, 1),  int3(8, 4, 7),  int3(2, 3, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(4, 7, 11),  int3(9, 4, 11),  int3(9, 11, 2),  int3(9, 2, 1),  int3(-1, -1, -1)},
            
            {
                 int3(3, 10, 1),  int3(3, 11, 10),  int3(7, 8, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 11, 10),  int3(1, 4, 11),  int3(1, 0, 4),  int3(7, 11, 4),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 7, 8),  int3(9, 0, 11),  int3(9, 11, 10),  int3(11, 0, 3),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 7, 11),  int3(4, 11, 9),  int3(9, 11, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 5, 4),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(9, 5, 4),  int3(0, 8, 3),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 5, 4),  int3(1, 5, 0),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(8, 5, 4),  int3(8, 3, 5),  int3(3, 1, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(1, 2, 10),  int3(9, 5, 4),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 0, 8),  int3(1, 2, 10),  int3(4, 9, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 2, 10),  int3(5, 4, 2),  int3(4, 0, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 10, 5),  int3(3, 2, 5),  int3(3, 5, 4),  int3(3, 4, 8),  int3(-1, -1, -1)},
            
            {
                 int3(9, 5, 4),  int3(2, 3, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 11, 2),  int3(0, 8, 11),  int3(4, 9, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 5, 4),  int3(0, 1, 5),  int3(2, 3, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 1, 5),  int3(2, 5, 8),  int3(2, 8, 11),  int3(4, 8, 5),  int3(-1, -1, -1)},
            
            {
                 int3(10, 3, 11),  int3(10, 1, 3),  int3(9, 5, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(4, 9, 5),  int3(0, 8, 1),  int3(8, 10, 1),  int3(8, 11, 10),  int3(-1, -1, -1)},
            
            {
                 int3(5, 4, 0),  int3(5, 0, 11),  int3(5, 11, 10),  int3(11, 0, 3),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 4, 8),  int3(5, 8, 10),  int3(10, 8, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 7, 8),  int3(5, 7, 9),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(9, 3, 0),  int3(9, 5, 3),  int3(5, 7, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(0, 7, 8),  int3(0, 1, 7),  int3(1, 5, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(1, 5, 3),  int3(3, 5, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 7, 8),  int3(9, 5, 7),  int3(10, 1, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(10, 1, 2),  int3(9, 5, 0),  int3(5, 3, 0),  int3(5, 7, 3),  int3(-1, -1, -1)},
             { int3(8, 0, 2),  int3(8, 2, 5),  int3(8, 5, 7),  int3(10, 5, 2),  int3(-1, -1, -1)},
            
            {
                 int3(2, 10, 5),  int3(2, 5, 3),  int3(3, 5, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(7, 9, 5),  int3(7, 8, 9),  int3(3, 11, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(9, 5, 7),  int3(9, 7, 2),  int3(9, 2, 0),  int3(2, 7, 11),  int3(-1, -1, -1)},
             { int3(2, 3, 11),  int3(0, 1, 8),  int3(1, 7, 8),  int3(1, 5, 7),  int3(-1, -1, -1)},
            
            {
                 int3(11, 2, 1),  int3(11, 1, 7),  int3(7, 1, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(9, 5, 8),  int3(8, 5, 7),  int3(10, 1, 3),  int3(10, 3, 11),  int3(-1, -1, -1)},
             { int3(5, 7, 0),  int3(5, 0, 9),  int3(7, 11, 0),  int3(1, 0, 10),  int3(11, 10, 0)},
             { int3(11, 10, 0),  int3(11, 0, 3),  int3(10, 5, 0),  int3(8, 0, 7),  int3(5, 7, 0)},
            
            {
                 int3(11, 10, 5),  int3(7, 11, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(10, 6, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 8, 3),  int3(5, 10, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 0, 1),  int3(5, 10, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 8, 3),  int3(1, 9, 8),  int3(5, 10, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 6, 5),  int3(2, 6, 1),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(1, 6, 5),  int3(1, 2, 6),  int3(3, 0, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(9, 6, 5),  int3(9, 0, 6),  int3(0, 2, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(5, 9, 8),  int3(5, 8, 2),  int3(5, 2, 6),  int3(3, 2, 8),  int3(-1, -1, -1)},
            
            {
                 int3(2, 3, 11),  int3(10, 6, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(11, 0, 8),  int3(11, 2, 0),  int3(10, 6, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 9),  int3(2, 3, 11),  int3(5, 10, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(5, 10, 6),  int3(1, 9, 2),  int3(9, 11, 2),  int3(9, 8, 11),  int3(-1, -1, -1)},
            
            {
                 int3(6, 3, 11),  int3(6, 5, 3),  int3(5, 1, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 8, 11),  int3(0, 11, 5),  int3(0, 5, 1),  int3(5, 11, 6),  int3(-1, -1, -1)},
             { int3(3, 11, 6),  int3(0, 3, 6),  int3(0, 6, 5),  int3(0, 5, 9),  int3(-1, -1, -1)},
            
            {
                 int3(6, 5, 9),  int3(6, 9, 11),  int3(11, 9, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 10, 6),  int3(4, 7, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 3, 0),  int3(4, 7, 3),  int3(6, 5, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 9, 0),  int3(5, 10, 6),  int3(8, 4, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(10, 6, 5),  int3(1, 9, 7),  int3(1, 7, 3),  int3(7, 9, 4),  int3(-1, -1, -1)},
             { int3(6, 1, 2),  int3(6, 5, 1),  int3(4, 7, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(1, 2, 5),  int3(5, 2, 6),  int3(3, 0, 4),  int3(3, 4, 7),  int3(-1, -1, -1)},
             { int3(8, 4, 7),  int3(9, 0, 5),  int3(0, 6, 5),  int3(0, 2, 6),  int3(-1, -1, -1)},
             { int3(7, 3, 9),  int3(7, 9, 4),  int3(3, 2, 9),  int3(5, 9, 6),  int3(2, 6, 9)},
            
            {
                 int3(3, 11, 2),  int3(7, 8, 4),  int3(10, 6, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(5, 10, 6),  int3(4, 7, 2),  int3(4, 2, 0),  int3(2, 7, 11),  int3(-1, -1, -1)},
             { int3(0, 1, 9),  int3(4, 7, 8),  int3(2, 3, 11),  int3(5, 10, 6),  int3(-1, -1, -1)},
             { int3(9, 2, 1),  int3(9, 11, 2),  int3(9, 4, 11),  int3(7, 11, 4),  int3(5, 10, 6)},
             { int3(8, 4, 7),  int3(3, 11, 5),  int3(3, 5, 1),  int3(5, 11, 6),  int3(-1, -1, -1)},
             { int3(5, 1, 11),  int3(5, 11, 6),  int3(1, 0, 11),  int3(7, 11, 4),  int3(0, 4, 11)},
             { int3(0, 5, 9),  int3(0, 6, 5),  int3(0, 3, 6),  int3(11, 6, 3),  int3(8, 4, 7)},
             { int3(6, 5, 9),  int3(6, 9, 11),  int3(4, 7, 9),  int3(7, 11, 9),  int3(-1, -1, -1)},
            
            {
                 int3(10, 4, 9),  int3(6, 4, 10),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 10, 6),  int3(4, 9, 10),  int3(0, 8, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(10, 0, 1),  int3(10, 6, 0),  int3(6, 4, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(8, 3, 1),  int3(8, 1, 6),  int3(8, 6, 4),  int3(6, 1, 10),  int3(-1, -1, -1)},
             { int3(1, 4, 9),  int3(1, 2, 4),  int3(2, 6, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(3, 0, 8),  int3(1, 2, 9),  int3(2, 4, 9),  int3(2, 6, 4),  int3(-1, -1, -1)},
            
            {
                 int3(0, 2, 4),  int3(4, 2, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(8, 3, 2),  int3(8, 2, 4),  int3(4, 2, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(10, 4, 9),  int3(10, 6, 4),  int3(11, 2, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 8, 2),  int3(2, 8, 11),  int3(4, 9, 10),  int3(4, 10, 6),  int3(-1, -1, -1)},
             { int3(3, 11, 2),  int3(0, 1, 6),  int3(0, 6, 4),  int3(6, 1, 10),  int3(-1, -1, -1)},
             { int3(6, 4, 1),  int3(6, 1, 10),  int3(4, 8, 1),  int3(2, 1, 11),  int3(8, 11, 1)},
             { int3(9, 6, 4),  int3(9, 3, 6),  int3(9, 1, 3),  int3(11, 6, 3),  int3(-1, -1, -1)},
             { int3(8, 11, 1),  int3(8, 1, 0),  int3(11, 6, 1),  int3(9, 1, 4),  int3(6, 4, 1)},
            
            {
                 int3(3, 11, 6),  int3(3, 6, 0),  int3(0, 6, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(6, 4, 8),  int3(11, 6, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(7, 10, 6),  int3(7, 8, 10),  int3(8, 9, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 7, 3),  int3(0, 10, 7),  int3(0, 9, 10),  int3(6, 7, 10),  int3(-1, -1, -1)},
             { int3(10, 6, 7),  int3(1, 10, 7),  int3(1, 7, 8),  int3(1, 8, 0),  int3(-1, -1, -1)},
            
            {
                 int3(10, 6, 7),  int3(10, 7, 1),  int3(1, 7, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(1, 2, 6),  int3(1, 6, 8),  int3(1, 8, 9),  int3(8, 6, 7),  int3(-1, -1, -1)},
             { int3(2, 6, 9),  int3(2, 9, 1),  int3(6, 7, 9),  int3(0, 9, 3),  int3(7, 3, 9)},
             { int3(7, 8, 0),  int3(7, 0, 6),  int3(6, 0, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(7, 3, 2),  int3(6, 7, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 3, 11),  int3(10, 6, 8),  int3(10, 8, 9),  int3(8, 6, 7),  int3(-1, -1, -1)},
             { int3(2, 0, 7),  int3(2, 7, 11),  int3(0, 9, 7),  int3(6, 7, 10),  int3(9, 10, 7)},
             { int3(1, 8, 0),  int3(1, 7, 8),  int3(1, 10, 7),  int3(6, 7, 10),  int3(2, 3, 11)},
             { int3(11, 2, 1),  int3(11, 1, 7),  int3(10, 6, 1),  int3(6, 7, 1),  int3(-1, -1, -1)},
             { int3(8, 9, 6),  int3(8, 6, 7),  int3(9, 1, 6),  int3(11, 6, 3),  int3(1, 3, 6)},
            
            {
                 int3(0, 9, 1),  int3(11, 6, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(7, 8, 0),  int3(7, 0, 6),  int3(3, 11, 0),  int3(11, 6, 0),  int3(-1, -1, -1)},
            
            {
                 int3(7, 11, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(7, 6, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(3, 0, 8),  int3(11, 7, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 9),  int3(11, 7, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(8, 1, 9),  int3(8, 3, 1),  int3(11, 7, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(10, 1, 2),  int3(6, 11, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 2, 10),  int3(3, 0, 8),  int3(6, 11, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(2, 9, 0),  int3(2, 10, 9),  int3(6, 11, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(6, 11, 7),  int3(2, 10, 3),  int3(10, 8, 3),  int3(10, 9, 8),  int3(-1, -1, -1)
            },
            
            {
                 int3(7, 2, 3),  int3(6, 2, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(7, 0, 8),  int3(7, 6, 0),  int3(6, 2, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(2, 7, 6),  int3(2, 3, 7),  int3(0, 1, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(1, 6, 2),  int3(1, 8, 6),  int3(1, 9, 8),  int3(8, 7, 6),  int3(-1, -1, -1)},
            
            {
                 int3(10, 7, 6),  int3(10, 1, 7),  int3(1, 3, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(10, 7, 6),  int3(1, 7, 10),  int3(1, 8, 7),  int3(1, 0, 8),  int3(-1, -1, -1)},
             { int3(0, 3, 7),  int3(0, 7, 10),  int3(0, 10, 9),  int3(6, 10, 7),  int3(-1, -1, -1)},
            
            {
                 int3(7, 6, 10),  int3(7, 10, 8),  int3(8, 10, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(6, 8, 4),  int3(11, 8, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 6, 11),  int3(3, 0, 6),  int3(0, 4, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(8, 6, 11),  int3(8, 4, 6),  int3(9, 0, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(9, 4, 6),  int3(9, 6, 3),  int3(9, 3, 1),  int3(11, 3, 6),  int3(-1, -1, -1)},
            
            {
                 int3(6, 8, 4),  int3(6, 11, 8),  int3(2, 10, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(1, 2, 10),  int3(3, 0, 11),  int3(0, 6, 11),  int3(0, 4, 6),  int3(-1, -1, -1)},
             { int3(4, 11, 8),  int3(4, 6, 11),  int3(0, 2, 9),  int3(2, 10, 9),  int3(-1, -1, -1)},
             { int3(10, 9, 3),  int3(10, 3, 2),  int3(9, 4, 3),  int3(11, 3, 6),  int3(4, 6, 3)},
             { int3(8, 2, 3),  int3(8, 4, 2),  int3(4, 6, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(0, 4, 2),  int3(4, 6, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(1, 9, 0),  int3(2, 3, 4),  int3(2, 4, 6),  int3(4, 3, 8),  int3(-1, -1, -1)},
             { int3(1, 9, 4),  int3(1, 4, 2),  int3(2, 4, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(8, 1, 3),  int3(8, 6, 1),  int3(8, 4, 6),  int3(6, 10, 1),  int3(-1, -1, -1)},
            
            {
                 int3(10, 1, 0),  int3(10, 0, 6),  int3(6, 0, 4),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(4, 6, 3),  int3(4, 3, 8),  int3(6, 10, 3),  int3(0, 3, 9),  int3(10, 9, 3)},
            
            {
                 int3(10, 9, 4),  int3(6, 10, 4),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 9, 5),  int3(7, 6, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 8, 3),  int3(4, 9, 5),  int3(11, 7, 6),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 0, 1),  int3(5, 4, 0),  int3(7, 6, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(11, 7, 6),  int3(8, 3, 4),  int3(3, 5, 4),  int3(3, 1, 5),  int3(-1, -1, -1)},
            
            {
                 int3(9, 5, 4),  int3(10, 1, 2),  int3(7, 6, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(6, 11, 7),  int3(1, 2, 10),  int3(0, 8, 3),  int3(4, 9, 5),  int3(-1, -1, -1)},
             { int3(7, 6, 11),  int3(5, 4, 10),  int3(4, 2, 10),  int3(4, 0, 2),  int3(-1, -1, -1)},
             { int3(3, 4, 8),  int3(3, 5, 4),  int3(3, 2, 5),  int3(10, 5, 2),  int3(11, 7, 6)},
             { int3(7, 2, 3),  int3(7, 6, 2),  int3(5, 4, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(9, 5, 4),  int3(0, 8, 6),  int3(0, 6, 2),  int3(6, 8, 7),  int3(-1, -1, -1)},
             { int3(3, 6, 2),  int3(3, 7, 6),  int3(1, 5, 0),  int3(5, 4, 0),  int3(-1, -1, -1)},
             { int3(6, 2, 8),  int3(6, 8, 7),  int3(2, 1, 8),  int3(4, 8, 5),  int3(1, 5, 8)},
             { int3(9, 5, 4),  int3(10, 1, 6),  int3(1, 7, 6),  int3(1, 3, 7),  int3(-1, -1, -1)},
             { int3(1, 6, 10),  int3(1, 7, 6),  int3(1, 0, 7),  int3(8, 7, 0),  int3(9, 5, 4)},
             { int3(4, 0, 10),  int3(4, 10, 5),  int3(0, 3, 10),  int3(6, 10, 7),  int3(3, 7, 10)},
            
            {
                 int3(7, 6, 10),  int3(7, 10, 8),  int3(5, 4, 10),  int3(4, 8, 10),  int3(-1, -1, -1)
            },
            
            {
                 int3(6, 9, 5),  int3(6, 11, 9),  int3(11, 8, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(3, 6, 11),  int3(0, 6, 3),  int3(0, 5, 6),  int3(0, 9, 5),  int3(-1, -1, -1)},
             { int3(0, 11, 8),  int3(0, 5, 11),  int3(0, 1, 5),  int3(5, 6, 11),  int3(-1, -1, -1)},
            
            {
                 int3(6, 11, 3),  int3(6, 3, 5),  int3(5, 3, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(1, 2, 10),  int3(9, 5, 11),  int3(9, 11, 8),  int3(11, 5, 6),  int3(-1, -1, -1)
            },
             { int3(0, 11, 3),  int3(0, 6, 11),  int3(0, 9, 6),  int3(5, 6, 9),  int3(1, 2, 10)},
             { int3(11, 8, 5),  int3(11, 5, 6),  int3(8, 0, 5),  int3(10, 5, 2),  int3(0, 2, 5)},
             { int3(6, 11, 3),  int3(6, 3, 5),  int3(2, 10, 3),  int3(10, 5, 3),  int3(-1, -1, -1)},
             { int3(5, 8, 9),  int3(5, 2, 8),  int3(5, 6, 2),  int3(3, 8, 2),  int3(-1, -1, -1)},
             { int3(9, 5, 6),  int3(9, 6, 0),  int3(0, 6, 2),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(1, 5, 8),  int3(1, 8, 0),  int3(5, 6, 8),  int3(3, 8, 2),  int3(6, 2, 8)},
            
            {
                 int3(1, 5, 6),  int3(2, 1, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(1, 3, 6),  int3(1, 6, 10),  int3(3, 8, 6),  int3(5, 6, 9),  int3(8, 9, 6)},
             { int3(10, 1, 0),  int3(10, 0, 6),  int3(9, 5, 0),  int3(5, 6, 0),  int3(-1, -1, -1)},
            
            {
                 int3(0, 3, 8),  int3(5, 6, 10),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(10, 5, 6),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(11, 5, 10),  int3(7, 5, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(11, 5, 10),  int3(11, 7, 5),  int3(8, 3, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 11, 7),  int3(5, 10, 11),  int3(1, 9, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(10, 7, 5),  int3(10, 11, 7),  int3(9, 8, 1),  int3(8, 3, 1),  int3(-1, -1, -1)},
            
            {
                 int3(11, 1, 2),  int3(11, 7, 1),  int3(7, 5, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 8, 3),  int3(1, 2, 7),  int3(1, 7, 5),  int3(7, 2, 11),  int3(-1, -1, -1)},
             { int3(9, 7, 5),  int3(9, 2, 7),  int3(9, 0, 2),  int3(2, 11, 7),  int3(-1, -1, -1)},
             { int3(7, 5, 2),  int3(7, 2, 11),  int3(5, 9, 2),  int3(3, 2, 8),  int3(9, 8, 2)},
            
            {
                 int3(2, 5, 10),  int3(2, 3, 5),  int3(3, 7, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(8, 2, 0),  int3(8, 5, 2),  int3(8, 7, 5),  int3(10, 2, 5),  int3(-1, -1, -1)},
             { int3(9, 0, 1),  int3(5, 10, 3),  int3(5, 3, 7),  int3(3, 10, 2),  int3(-1, -1, -1)},
             { int3(9, 8, 2),  int3(9, 2, 1),  int3(8, 7, 2),  int3(10, 2, 5),  int3(7, 5, 2)},
            
            {
                 int3(1, 3, 5),  int3(3, 7, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 8, 7),  int3(0, 7, 1),  int3(1, 7, 5),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(9, 0, 3),  int3(9, 3, 5),  int3(5, 3, 7),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(9, 8, 7),  int3(5, 9, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 8, 4),  int3(5, 10, 8),  int3(10, 11, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(5, 0, 4),  int3(5, 11, 0),  int3(5, 10, 11),  int3(11, 3, 0),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 9),  int3(8, 4, 10),  int3(8, 10, 11),  int3(10, 4, 5),  int3(-1, -1, -1)
            },
             { int3(10, 11, 4),  int3(10, 4, 5),  int3(11, 3, 4),  int3(9, 4, 1),  int3(3, 1, 4)},
             { int3(2, 5, 1),  int3(2, 8, 5),  int3(2, 11, 8),  int3(4, 5, 8),  int3(-1, -1, -1)},
             { int3(0, 4, 11),  int3(0, 11, 3),  int3(4, 5, 11),  int3(2, 11, 1),  int3(5, 1, 11)},
             { int3(0, 2, 5),  int3(0, 5, 9),  int3(2, 11, 5),  int3(4, 5, 8),  int3(11, 8, 5)},
            
            {
                 int3(9, 4, 5),  int3(2, 11, 3),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 5, 10),  int3(3, 5, 2),  int3(3, 4, 5),  int3(3, 8, 4),  int3(-1, -1, -1)},
            
            {
                 int3(5, 10, 2),  int3(5, 2, 4),  int3(4, 2, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(3, 10, 2),  int3(3, 5, 10),  int3(3, 8, 5),  int3(4, 5, 8),  int3(0, 1, 9)},
             { int3(5, 10, 2),  int3(5, 2, 4),  int3(1, 9, 2),  int3(9, 4, 2),  int3(-1, -1, -1)},
             { int3(8, 4, 5),  int3(8, 5, 3),  int3(3, 5, 1),  int3(-1, -1, -1),  int3(-1, -1, -1)},
            
            {
                 int3(0, 4, 5),  int3(1, 0, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(8, 4, 5),  int3(8, 5, 3),  int3(9, 0, 5),  int3(0, 3, 5),  int3(-1, -1, -1)},
            
            {
                 int3(9, 4, 5),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(4, 11, 7),  int3(4, 9, 11),  int3(9, 10, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(0, 8, 3),  int3(4, 9, 7),  int3(9, 11, 7),  int3(9, 10, 11),  int3(-1, -1, -1)},
            
            {
                 int3(1, 10, 11),  int3(1, 11, 4),  int3(1, 4, 0),  int3(7, 4, 11),  int3(-1, -1, -1)
            },
             { int3(3, 1, 4),  int3(3, 4, 8),  int3(1, 10, 4),  int3(7, 4, 11),  int3(10, 11, 4)},
             { int3(4, 11, 7),  int3(9, 11, 4),  int3(9, 2, 11),  int3(9, 1, 2),  int3(-1, -1, -1)},
             { int3(9, 7, 4),  int3(9, 11, 7),  int3(9, 1, 11),  int3(2, 11, 1),  int3(0, 8, 3)},
            
            {
                 int3(11, 7, 4),  int3(11, 4, 2),  int3(2, 4, 0),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(11, 7, 4),  int3(11, 4, 2),  int3(8, 3, 4),  int3(3, 2, 4),  int3(-1, -1, -1)},
             { int3(2, 9, 10),  int3(2, 7, 9),  int3(2, 3, 7),  int3(7, 4, 9),  int3(-1, -1, -1)},
             { int3(9, 10, 7),  int3(9, 7, 4),  int3(10, 2, 7),  int3(8, 7, 0),  int3(2, 0, 7)},
             { int3(3, 7, 10),  int3(3, 10, 2),  int3(7, 4, 10),  int3(1, 10, 0),  int3(4, 0, 10)},
            
            {
                 int3(1, 10, 2),  int3(8, 7, 4),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(4, 9, 1),  int3(4, 1, 7),  int3(7, 1, 3),  int3(-1, -1, -1),  int3(-1, -1, -1)},
             { int3(4, 9, 1),  int3(4, 1, 7),  int3(0, 8, 1),  int3(8, 7, 1),  int3(-1, -1, -1)},
            
            {
                 int3(4, 0, 3),  int3(7, 4, 3),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(4, 8, 7),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(9, 10, 8),  int3(10, 11, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(3, 0, 9),  int3(3, 9, 11),  int3(11, 9, 10),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 1, 10),  int3(0, 10, 8),  int3(8, 10, 11),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 1, 10),  int3(11, 3, 10),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(1, 2, 11),  int3(1, 11, 9),  int3(9, 11, 8),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(3, 0, 9),  int3(3, 9, 11),  int3(1, 2, 9),  int3(2, 11, 9),  int3(-1, -1, -1)},
            
            {
                 int3(0, 2, 11),  int3(8, 0, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(3, 2, 11),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(2, 3, 8),  int3(2, 8, 10),  int3(10, 8, 9),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(9, 10, 2),  int3(0, 9, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
             { int3(2, 3, 8),  int3(2, 8, 10),  int3(0, 1, 8),  int3(1, 10, 8),  int3(-1, -1, -1)},
            
            {
                 int3(1, 10, 2),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(1, 3, 8),  int3(9, 1, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1)
            },
            
            {
                 int3(0, 9, 1),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(0, 3, 8),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            },
            
            {
                 int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),  int3(-1, -1, -1),
                 int3(-1, -1, -1)
            }
       };

float f(float3 position)
{
    float f = 0;
    // Naive implementation, just runs for all balls regardless the distance.
    // A better option would be to construct a sparse grid specifically around 
    for (int i = 0; i < ballsCount; i++)
    {
        float3 center = ballsPositions[i];
        float3 tmp = center - position;
        f += 1 / (tmp.x * tmp.x + tmp.y * tmp.y + tmp.z * tmp.z);
    }

    f *= ballRadius * ballRadius;

    return f - 1;
}

void processCube(float3 startPosition)
{
     float x = startPosition.x;
     float y = startPosition.y;
     float z = startPosition.z;
     float3 cube[] = {
          float3(x, y, z),
          float3(x, y + size, z),
          float3(x + size, y + size, z),
          float3(x + size, y, z),
          float3(x, y, z + size),
          float3(x, y + size, z + size),
          float3(x + size, y + size, z + size),
          float3(x + size, y, z + size),
     };
     
    uint mask = 0;
    for (int i = 0; i < 8; i++)
    {
        if (f(cube[i]) > 0)
        {
            mask |= 1 << i;
        }
    }
     
    float Eps = 0.01;
    for (int q = 0; q < caseToTrianglesCount[mask]; q++)
    {
        float3 outputVertex[3];
        float3 outputNormal[3];
        for (int j = 0; j < 3; j++)
        {
            float3 first = cube[cubeEdges[caseToVertices[mask][q][j]][0]];
            float3 second = cube[cubeEdges[caseToVertices[mask][q][j]][1]];
             
            float intersectionFraction = f(second) / (f(second) - f(first));
            float3 vertex = intersectionFraction * first + (1 - intersectionFraction) * second;
             
            float3 normal = float3(
                f(vertex + Eps * float3(1, 0, 0)) - f(vertex + Eps * float3(-1, 0, 0)),
                f(vertex + Eps * float3(0, 1, 0)) - f(vertex + Eps * float3(0, -1, 0)),
                f(vertex + Eps * float3(0, 0, 1)) - f(vertex + Eps * float3(0, 0, -1))
            );

            normal = -normal / length(normal);
             
            outputVertex[j] = vertex;
            outputNormal[j] = normal;
        }

        Output output;
        output.hasValue = 1;
        output.normal = outputNormal;
        output.vertex = outputVertex;
        outputBuffer.Append(output);
    }
}

[numthreads(8, 8, 8)]
void Generate (uint3 id : SV_DispatchThreadID)
{
    processCube(float3(
        minBound + id.x * size,
        minBound + id.y * size,
        minBound + id.z * size
    ));
}

